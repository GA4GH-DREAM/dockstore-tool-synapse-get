#!/usr/bin/env bash
set -euf -o pipefail

CMD_ARGS=('synapse' 'get')
while getopts "c:i:q:h" ARG; do
    case "$ARG" in
    	c ) CONFIG=$OPTARG;;
        i ) ENTITY_ID=$OPTARG; CMD_ARGS=("${CMD_ARGS[@]}" $ENTITY_ID);;
		q ) QUERY=$OPTARG; CMD_ARGS=("${CMD_ARGS[@]}" '-q \"{$QUERY}\"');;
        h ) usage; exit 0;;
        * ) usage; exit 1;;
    esac
done
shift $(($OPTIND - 1))

# parse credentials from config file
CREDENTIALS=($(python /usr/local/bin/parse_config.py ${CONFIG}))
# get file from Synapse
synapse login -u ${CREDENTIALS[0]} -p ${CREDENTIALS[1]} --rememberMe

COMMAND=$( IFS=' '; echo "${CMD_ARGS[*]}" );
echo $COMMAND
eval $COMMAND


# QUERY="select id from file where parentId == 'syn8507134'"
# COMMAND="synapse get -q \"${QUERY}\""
# eval $COMMAND